<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced R Solutions</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Solutions to the exercises in Hadley Wickhams book Advanced R.">
  <meta name="generator" content="bookdown 0.1.7 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced R Solutions" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Solutions to the exercises in Hadley Wickhams book Advanced R." />
  <meta name="github-repo" content="Tazinho/Advanced-R-Solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced R Solutions" />
  
  <meta name="twitter:description" content="Solutions to the exercises in Hadley Wickhams book Advanced R." />
  

<meta name="author" content="Malte Grosser &amp; Henning Bumann">

<meta name="date" content="2016-09-12">


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="oo-field-guide.html">
<link rel="next" href="exceptions-and-debugging.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>1</b> Data structures</a></li>
<li class="chapter" data-level="2" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>2</b> Subsetting</a></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a></li>
<li class="chapter" data-level="4" data-path="oo-field-guide.html"><a href="oo-field-guide.html"><i class="fa fa-check"></i><b>4</b> OO field guide</a></li>
<li class="chapter" data-level="5" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>5</b> Environments</a><ul>
<li class="chapter" data-level="5.1" data-path="environments.html"><a href="environments.html#environment-basics"><i class="fa fa-check"></i><b>5.1</b> Environment basics</a></li>
<li class="chapter" data-level="5.2" data-path="environments.html"><a href="environments.html#recursing-over-environments"><i class="fa fa-check"></i><b>5.2</b> Recursing over environments</a></li>
<li class="chapter" data-level="5.3" data-path="environments.html"><a href="environments.html#function-environments"><i class="fa fa-check"></i><b>5.3</b> Function environments</a></li>
<li class="chapter" data-level="5.4" data-path="environments.html"><a href="environments.html#binding-names-to-values"><i class="fa fa-check"></i><b>5.4</b> Binding names to values</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exceptions-and-debugging.html"><a href="exceptions-and-debugging.html"><i class="fa fa-check"></i><b>6</b> Exceptions and debugging</a></li>
<li class="chapter" data-level="7" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>7</b> Functional programming</a></li>
<li class="chapter" data-level="8" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>8</b> Functionals</a></li>
<li class="chapter" data-level="9" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>9</b> Function operators</a></li>
<li class="chapter" data-level="10" data-path="non-standard-evaluation.html"><a href="non-standard-evaluation.html"><i class="fa fa-check"></i><b>10</b> Non standard evaluation</a></li>
<li class="chapter" data-level="11" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>11</b> Expressions</a></li>
<li class="chapter" data-level="12" data-path="domain-specific-languages.html"><a href="domain-specific-languages.html"><i class="fa fa-check"></i><b>12</b> Domain specific languages</a></li>
<li class="chapter" data-level="13" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>13</b> Performance</a></li>
<li class="chapter" data-level="14" data-path="profiling.html"><a href="profiling.html"><i class="fa fa-check"></i><b>14</b> Profiling</a></li>
<li class="chapter" data-level="15" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>15</b> Memory</a></li>
<li class="chapter" data-level="16" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>16</b> Rcpp</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R Solutions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="environments" class="section level1">
<h1><span class="header-section-number">5</span> Environments</h1>
<div id="environment-basics" class="section level2">
<h2><span class="header-section-number">5.1</span> Environment basics</h2>
<ol style="list-style-type: decimal">
<li><strong><span style="color:red">Q</span></strong>: List three ways in which an environment differs from a list.<br />
<strong><span style="color:green">A</span></strong>: The most important differences are:
<ul>
<li>environments have reference semantics</li>
<li>environments have parents</li>
<li>environments are not ordered</li>
<li>elements of environments need to be (uniquely) named</li>
</ul></li>
<li><p><strong><span style="color:red">Q</span></strong>: If you don’t supply an explicit environment, where do <code>ls()</code> and <code>rm()</code> look? Where does <code>&lt;-</code> make bindings? The<br />
<strong><span style="color:green">A</span></strong>: <code>ls()</code> and <code>rm</code> look in their calling environments which they find by <code>as.environment(-1)</code>.<br />
From the book:</p>
<blockquote>
<p>Assignment is the act of binding (or rebinding) a name to a value in an environment.</p>
</blockquote>
<p>From <code>?`&lt;-`</code>:</p>
<blockquote>
<p>The operators <code>&lt;-</code> and <code>=</code> assign into the environment in which they are evaluated. The operator <code>&lt;-</code> can be used anywhere, whereas the operator <code>=</code> is only allowed at the top level (e.g., in the complete expression typed at the command prompt) or as one of the subexpressions in a braced list of expressions.</p>
</blockquote></li>
<li><p><strong><span style="color:red">Q</span></strong>: Using <code>parent.env()</code> and a loop (or a recursive function), verify that the ancestors of <code>globalenv()</code> include <code>baseenv()</code> and <code>emptyenv()</code>. Use the same basic idea to implement your own version of <code>search()</code>.<br />
<strong><span style="color:green">A</span></strong>: We can print the ancestors for example by using a recursive function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ancestors &lt;-<span class="st"> </span>function(<span class="dt">env =</span> <span class="kw">globalenv</span>()){
  if (<span class="kw">identical</span>(env, <span class="kw">emptyenv</span>())) {
    <span class="kw">print</span>(env)} 
  else {
    <span class="kw">print</span>(env)
    <span class="kw">ancestors</span>(<span class="kw">parent.env</span>(env))
  }
}

<span class="kw">ancestors</span>()</code></pre></div>
<p>To implement a new version of <code>search()</code> we use a while statement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">search2 &lt;-<span class="st"> </span>function(<span class="dt">env =</span> <span class="kw">globalenv</span>()){
  envs &lt;-<span class="st"> </span><span class="kw">character</span>()
  while (!<span class="kw">identical</span>(env, <span class="kw">emptyenv</span>())) {
    ename &lt;-<span class="st"> </span><span class="kw">environmentName</span>(env)
    if (ename ==<span class="st"> &quot;base&quot;</span>) ename &lt;-<span class="st"> &quot;package:base&quot;</span>
    if (ename ==<span class="st"> &quot;R_GlobalEnv&quot;</span>) ename &lt;-<span class="st"> &quot;.GlobalEnv&quot;</span>
    envs &lt;-<span class="st"> </span><span class="kw">c</span>(envs, ename)
    env &lt;-<span class="st"> </span><span class="kw">parent.env</span>(env)
    }
  <span class="kw">return</span>(envs)
}</code></pre></div></li>
</ol>
</div>
<div id="recursing-over-environments" class="section level2">
<h2><span class="header-section-number">5.2</span> Recursing over environments</h2>
<ol style="list-style-type: decimal">
<li><p><strong><span style="color:red">Q</span></strong>: Modify <code>where()</code> to find all environments that contain a binding for <code>name</code>.<br />
<strong><span style="color:green">A</span></strong>: We look at the source code of the original <code>pryr::where()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pryr::where
function (name, <span class="dt">env =</span> <span class="kw">parent.frame</span>()) 
  {
  <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(name), <span class="kw">length</span>(name) ==<span class="st"> </span><span class="dv">1</span>)
  env &lt;-<span class="st"> </span><span class="kw">to_env</span>(env)
  if (<span class="kw">identical</span>(env, <span class="kw">emptyenv</span>())) {
    <span class="kw">stop</span>(<span class="st">&quot;Can&#39;t find &quot;</span>, name, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
    }
  if (<span class="kw">exists</span>(name, env, <span class="dt">inherits =</span> <span class="ot">FALSE</span>)) {
    env
    }
  else {
    <span class="kw">where</span>(name, <span class="kw">parent.env</span>(env)) <span class="co"># we will copy this line in the last if block</span>
  }
}</code></pre></div>
<p>Since <code>where()</code> stops searching when a match appears, we copy the recursive call in the <code>else</code> block to the <code>block</code> of the matching case, so that our new function <code>where2</code> will look for a binding within the complete search path.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">where2 &lt;-<span class="st"> </span>function (name, <span class="dt">env =</span> <span class="kw">parent.frame</span>()) 
  {
  <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(name), <span class="kw">length</span>(name) ==<span class="st"> </span><span class="dv">1</span>)
  env &lt;-<span class="st"> </span><span class="kw">to_env</span>(env)
  if (<span class="kw">identical</span>(env, <span class="kw">emptyenv</span>())) {
    <span class="kw">stop</span>(<span class="st">&quot;Can&#39;t find &quot;</span>, name, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
    }
  if (<span class="kw">exists</span>(name, env, <span class="dt">inherits =</span> <span class="ot">FALSE</span>)) {
    env
    <span class="kw">where</span>(name, <span class="kw">parent.env</span>(env))
    }
  else {
    <span class="kw">where</span>(name, <span class="kw">parent.env</span>(env))
  }
}</code></pre></div></li>
<li><p><strong><span style="color:red">Q</span></strong>: Write your own version of <code>get()</code> using a function written in the style of <code>where()</code>.<br />
<strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Write a function called <code>fget()</code> that finds only function objects. It should have two arguments, <code>name</code> and <code>env</code>, and should obey the regular scoping rules for functions: if there’s an object with a matching name that’s not a function, look in the parent. For an added challenge, also add an <code>inherits</code> argument which controls whether the function recurses up the parents or only looks in one environment.<br />
<strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Write your own version of <code>exists(inherits = FALSE)</code> (Hint: use <code>ls()</code>.) Write a recursive version that behaves like <code>exists(inherits = TRUE)</code>.<br />
<strong><span style="color:green">A</span></strong>:</p></li>
</ol>
</div>
<div id="function-environments" class="section level2">
<h2><span class="header-section-number">5.3</span> Function environments</h2>
<ol style="list-style-type: decimal">
<li><strong><span style="color:red">Q</span></strong>: List the four environments associated with a function. What does each one do? Why is the distinction between enclosing and binding environments particularly important?<br />
<strong><span style="color:green">A</span></strong>:
<ul>
<li>Enclosing: where the function is created</li>
<li>Binding: where the function was assigned</li>
<li>Execution: a temporary environment which is created when the function is executed</li>
<li>Calling: the environment from where the function was called</li>
</ul>
<p>The difference between binding and enclosing environment is important, because of R’s lexical scoping rules. If R can’t find an object in the current environment while executing a function, it will look for it in the enclosing environment.</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Draw a diagram that shows the enclosing environments of this function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f1 &lt;-<span class="st"> </span>function(x1) {
  f2 &lt;-<span class="st"> </span>function(x2) {
    f3 &lt;-<span class="st"> </span>function(x3) {
      x1 +<span class="st"> </span>x2 +<span class="st"> </span>x3
    }
    <span class="kw">f3</span>(<span class="dv">3</span>)
  }
  <span class="kw">f2</span>(<span class="dv">2</span>)
}
<span class="kw">f1</span>(<span class="dv">1</span>)</code></pre></div>
<p><strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Expand your previous diagram to show function bindings.<br />
<strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Expand it again to show the execution and calling environments.<br />
<strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Write an enhanced version of <code>str()</code> that provides more information about functions. Show where the function was found and what environment it was defined in.<br />
<strong><span style="color:green">A</span></strong>:</p></li>
</ol>
</div>
<div id="binding-names-to-values" class="section level2">
<h2><span class="header-section-number">5.4</span> Binding names to values</h2>
<ol style="list-style-type: decimal">
<li><p><strong><span style="color:red">Q</span></strong>: What does this function do? How does it differ from <code>&lt;&lt;-</code> and why might you prefer it?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rebind &lt;-<span class="st"> </span>function(name, value, <span class="dt">env =</span> <span class="kw">parent.frame</span>()) {
  if (<span class="kw">identical</span>(env, <span class="kw">emptyenv</span>())) {
    <span class="kw">stop</span>(<span class="st">&quot;Can&#39;t find &quot;</span>, name, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
  } else if (<span class="kw">exists</span>(name, <span class="dt">envir =</span> env, <span class="dt">inherits =</span> <span class="ot">FALSE</span>)) {
    <span class="kw">assign</span>(name, value, <span class="dt">envir =</span> env)
  } else {
    <span class="kw">rebind</span>(name, value, <span class="kw">parent.env</span>(env))
  }
}
<span class="kw">rebind</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">10</span>)</code></pre></div>
<pre><code>## Error: Can&#39;t find a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="kw">rebind</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">10</span>)
a</code></pre></div>
<pre><code>## [1] 10</code></pre>
<p><strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Create a version of <code>assign()</code> that will only bind new names, never re-bind old names. Some programming languages only do this, and are known as [single assignment languages][single assignment].<br />
<strong><span style="color:green">A</span></strong>:</p></li>
<li><p><strong><span style="color:red">Q</span></strong>: Write an assignment function that can do active, delayed, and locked bindings. What might you call it? What arguments should it take? Can you guess which sort of assignment it should do based on the input?<br />
<strong><span style="color:green">A</span></strong>:</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="oo-field-guide.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exceptions-and-debugging.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
